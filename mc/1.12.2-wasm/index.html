<!DOCTYPE html>
<html style="width:100%;height:100%;background-color:black;">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
		<meta name="description" content="Play minecraft 1.12 in your browser" />
		<meta name="keywords" content="eaglercraft, minecraft, 1.12, 1.12.2" />
		<title>Minecraft 1.12 WASM-GC</title>
		<meta property="og:locale" content="en-US" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Eaglercraft 1.12 WASM" />
		<meta property="og:description" content="Play minecraft 1.12 in your browser" />
		<meta property="og:image" content="favicon.png" />
		<link rel="icon" type="image/png" href="../../assets/images/mc-icons/grass.png" />
		<script type="text/javascript" src="bootstrap.js"></script>
		<script type="text/javascript">
			"use strict";
			window.addEventListener("load", function() {
				if(window.location.href.indexOf("file:") === 0) {
					alert("HTTP please, do not open this file locally, run a local HTTP server and load it via HTTP");
				}else {
					function applyLauncherSkin() {
						var raw = null;
						try { raw = window.localStorage.getItem("launcher.customSkin"); } catch(e) { return; }
						if(!raw) return;
						var skin = null;
						try { skin = JSON.parse(raw); } catch(e) { return; }
						if(!skin || !skin.data) return;
						var model = (skin.model === "slim") ? "slim" : "default";
						var skinData = skin.data || skin.raw;
						function mergeProfile(existing) {
							var profile = {};
							try { profile = existing ? JSON.parse(existing) : {}; } catch(e) { profile = {}; }
							if(typeof profile !== "object" || profile === null) profile = {};
							if(typeof profile.customSkin === "object" && profile.customSkin !== null) {
								profile.customSkin.data = skinData;
								profile.customSkin.model = model;
							} else {
								profile.customSkin = { data: skinData, model: model };
							}
							profile.customSkinModel = model;
							profile.presetSkin = "CUSTOM";
							return JSON.stringify(profile);
						}
						function writeKey(key) {
							try {
								var existing = window.localStorage.getItem(key);
								window.localStorage.setItem(key, mergeProfile(existing));
							} catch(e) {}
						}
						var namespaces = ["_eaglercraft_1.12", "_eaglercraftX", "_eaglercraft_1.8"];
						for(var i = 0; i < namespaces.length; i++) {
							var ns = namespaces[i];
							writeKey(ns + ".profile");
							writeKey(ns + ":profile");
							writeKey(ns + "/profile");
						}
						writeKey("profile");
					}
					function installSkinProfileHook() {
						var raw = null;
						try { raw = window.localStorage.getItem("launcher.customSkin"); } catch(e) { return; }
						if(!raw) return;
						var skin = null;
						try { skin = JSON.parse(raw); } catch(e) { return; }
						if(!skin || !skin.data) return;
						var model = (skin.model === "slim") ? "slim" : "default";
						var skinData = skin.data || skin.raw;
						var namespaces = ["_eaglercraft_1.12", "_eaglercraftX", "_eaglercraft_1.8"];
						var profileKeys = {};
						for(var i = 0; i < namespaces.length; i++) {
							var ns = namespaces[i];
							profileKeys[ns + ".profile"] = true;
							profileKeys[ns + ":profile"] = true;
							profileKeys[ns + "/profile"] = true;
						}
						profileKeys["profile"] = true;
						var origGet = window.localStorage.getItem;
						window.localStorage.getItem = function(key) {
							var val = origGet.call(this, key);
							if(!profileKeys[key]) return val;
							var profile = {};
							try { profile = val ? JSON.parse(val) : {}; } catch(e) { profile = {}; }
							if(typeof profile !== "object" || profile === null) profile = {};
							if(typeof profile.customSkin === "object" && profile.customSkin !== null) {
								profile.customSkin.data = skinData;
								profile.customSkin.model = model;
							} else {
								profile.customSkin = { data: skinData, model: model };
							}
							profile.customSkinModel = model;
							profile.presetSkin = "CUSTOM";
							return JSON.stringify(profile);
						};
					}
					function renderSkinDebug() {
						if(window.location.search.indexOf("skinDebug=1") === -1) return;
						var panel = document.createElement("div");
						panel.style.position = "fixed";
						panel.style.top = "10px";
						panel.style.left = "10px";
						panel.style.zIndex = "99999";
						panel.style.padding = "10px 12px";
						panel.style.background = "rgba(0,0,0,0.75)";
						panel.style.color = "#fff";
						panel.style.font = "12px/1.4 monospace";
						panel.style.border = "1px solid rgba(255,255,255,0.2)";
						panel.style.maxWidth = "420px";
						panel.style.whiteSpace = "pre-wrap";
						function safeGet(key) {
							try { return window.localStorage.getItem(key); } catch(e) { return null; }
						}
						function readProfile(key) {
							var raw = safeGet(key);
							if(!raw) return null;
							try { return JSON.parse(raw); } catch(e) { return { _parseError: true }; }
						}
						var keys = ["_eaglercraft_1.12.profile", "_eaglercraft_1.12:profile", "_eaglercraft_1.12/profile", "profile"];
						var lines = [];
						var launcherSkin = safeGet("launcher.customSkin");
						lines.push("launcher.customSkin: " + (launcherSkin ? "present" : "missing"));
						lines.push("");
						for(var i = 0; i < keys.length; i++) {
							var key = keys[i];
							var profile = readProfile(key);
							if(!profile) {
								lines.push(key + ": missing");
								continue;
							}
							if(profile._parseError) {
								lines.push(key + ": parse error");
								continue;
							}
							var cs = profile.customSkin;
							var csType = (cs && typeof cs === "object") ? "object" : (typeof cs);
							var csModel = (cs && typeof cs === "object" && cs.model) ? cs.model : (profile.customSkinModel || "n/a");
							lines.push(key + ": customSkin=" + csType + ", model=" + csModel + ", preset=" + (profile.presetSkin || "n/a"));
						}
						panel.textContent = lines.join("\n");
						panel.style.pointerEvents = "none";
						function ensurePanel() {
							if(!panel.parentNode) document.body.appendChild(panel);
							panel.style.zIndex = "2147483647";
						}
						ensurePanel();
						setInterval(ensurePanel, 250);
					}
					installSkinProfileHook();
					applyLauncherSkin();
					renderSkinDebug();
					
					// %%%%%%%%% launch options %%%%%%%%%%%%
					
					var relayId = Math.floor(Math.random() * 3);
					window.eaglercraftXOpts = {
						demoMode: false,
						container: "game_frame",
						assetsURI: "assets.epw",
						worldsDB: "worlds",
						servers: [
							{ addr: "wss://play.zelz.net", name: "ZelzNet" },
							{ addr: "wss://mc.arch.lol", name: "ArchMC" },
							{ addr: "wss://beta.arch.lol", name: "§r §r §r §r §4§lArchMC Beta" }
    						]
					};
					
					// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
					
					var q = window.location.search;
					if((typeof q === "string") && q[0] === "?" && (typeof window.URLSearchParams !== "undefined")) {
						q = new window.URLSearchParams(q);
						var s = q.get("server");
						if(s) window.eaglercraftXOpts.joinServer = s;
					}
					
					main();
					
				}
			});
		</script>
	</head>
	<body style="margin:0px;width:100%;height:100%;overflow:hidden;background-color:black;" id="game_frame"></body>
</html>
